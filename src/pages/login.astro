---
import AuthLayout from '../layouts/AuthLayout.astro';
import Card from '../components/atoms/Card.astro';
import Input from '../components/atoms/Input.astro';
import Button from '../components/atoms/Button.astro';
---

<AuthLayout title="Iniciar Sesión - SecureLife">
  <Card>
    <h2 class="text-2xl font-bold text-center text-gray-900 mb-6">
      Iniciar Sesión
    </h2>
    
    <form id="login-form" class="space-y-6">
      <Input
        type="email"
        name="email"
        label="Correo electrónico"
        placeholder="tu@email.com"
        required
      />
      
      <Input
        type="password"
        name="password"
        label="Contraseña"
        placeholder="Tu contraseña"
        required
      />
      
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <input
            id="remember-me"
            name="remember-me"
            type="checkbox"
            class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
          />
          <label for="remember-me" class="ml-2 block text-sm text-gray-900">
            Recordarme
          </label>
        </div>
        
        <div class="text-sm">
          <a href="/forgot-password" class="font-medium text-primary-600 hover:text-primary-500">
            ¿Olvidaste tu contraseña?
          </a>
        </div>
      </div>
      
      <Button type="submit" class="w-full">
        Iniciar Sesión
      </Button>
      
      <div class="text-center">
        <p class="text-sm text-gray-600">
          ¿No tienes una cuenta?
          <a href="/register" class="font-medium text-primary-600 hover:text-primary-500">
            Regístrate
          </a>
        </p>
      </div>
    </form>
  </Card>
</AuthLayout>

<script>
  import { login } from '../stores/auth';

  document.getElementById('login-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target as HTMLFormElement);
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;
    
    try {
      const result = await login(email, password);
      
      if (result.success) {
        alert('¡Inicio de sesión exitoso!');
        window.location.href = '/dashboard';
      } else {
        alert(result.error || 'Error al iniciar sesión');
      }
    } catch (error) {
      console.error('Error de login:', error);
      alert('Error al iniciar sesión. Verifica tus credenciales.');
    }
  });
</script>